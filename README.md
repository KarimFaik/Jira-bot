# JiraBot

JiraBot — это Telegram-бот, который позволяет пользователям создавать задачи в системе Jira через чат в Telegram. Бот запрашивает необходимую информацию (название задачи, описание, контактные данные и т.д.), позволяет прикреплять файлы (до 10 МБ) и отправляет задачу в Jira. Все данные сохраняются в локальной SQLite базе данных, а логи записываются в файл.

## Оглавление
- [Функциональность](#функциональность)
- [Требования](#требования)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Использование](#использование)
- [Структура проекта](#структура-проекта)
- [Контрибьютинг](#контрибьютинг)
- [Лицензия](#лицензия)

## Функциональность
- Создание задач в Jira через Telegram.
- Сбор данных: название задачи, описание, номер телефона, email, компания/отдел, имя и фамилия.
- Валидация номера телефона и email (с использованием регулярных выражений и проверки DNS для email).
- Возможность прикрепления файлов (фото или документы, до 10 МБ).
- Логирование всех действий в файл `bot.log` с ротацией.
- Сохранение данных в SQLite базу данных (`saved_data.sqlite`).
- Поддержка редактирования введенных данных перед отправкой.
- Возможность пропуска необязательных полей.
- Развертывание с помощью Docker.

## Требования
- Python 3.12.7
- Docker (для контейнеризации, опционально)
- Учетная запись Jira с API-токеном
- Telegram-бот с токеном (получите через BotFather)

## Установка

1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/your-username/jirabot.git
   cd jirabot
   ```

2. **Установите зависимости**:
   ```bash
   python -m pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Настройте виртуальное окружение** (опционально):
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/MacOS
   venv\Scripts\activate     # Windows
   ```

4. **Создайте файл `.env`** на основе `.env.dict`:
   ```bash
   cp .env.dict .env
   ```
   Заполните `.env` вашими данными:
   ```
   JIRA_TOKEN="your_jira_api_token"
   JIRA_URL="https://your-jira-instance.atlassian.net"
   TELEGRAM_BOT_TOKEN="your_telegram_bot_token"
   JIRA_PROJECT_TOKEN="your_jira_project_key"
   ```

5. **Запустите бота**:
   ```bash
   python app_Main.py
   ```

### Использование с Docker
1. **Соберите образ**:
   ```bash
   docker build -t jirabot .
   ```

2. **Запустите контейнер**:
   ```bash
   docker run --env-file .env -v $(pwd)/logs:/app/logs -v $(pwd)/sqlite:/app/sqlite jirabot
   ```

   Флаги:
   - `--env-file .env`: передает переменные окружения.
   - `-v`: монтирует папки `logs` и `sqlite` для сохранения логов и базы данных.

## Конфигурация
- **Jira**: Убедитесь, что у вас есть API-токен и доступ к проекту Jira. URL и токен задаются в `.env`.
- **Telegram**: Создайте бота через Bot\"], чтобы получить токен.
- **Логи**: Логи сохраняются в `logs/bot.log` с ротацией (максимум 5 МБ, до 5 резервных копий).
- **База данных**: SQLite база данных создается автоматически в `sqlite/saved_data.sqlite`.

## Использование
1. Запустите бота в Telegram, отправив команду `/start`.
2. Выберите «Начать новую задачу» или используйте `/new_task`.
3. Следуйте инструкциям бота:
   - Введите название задачи, описание, контактные данные.
   - Пропустите необязательные поля, если нужно.
   - Прикрепите файл (фото или документ, до 10 МБ), если требуется.
   - Подтвердите или отредактируйте данные перед отправкой.
4. После подтверждения бот создаст задачу в Jira и вернет ключ задачи (например, `PROJ-123`).
5. Логи и данные сохраняются локально.

### Команды
- `/start`: Запускает бота и показывает приветственное сообщение.
- `/new_task`: Начинает процесс создания новой задачи.
- `Помощь`: Показывает краткую справку.
- `Отмена задачи`: Отменяет текущий процесс и очищает данные.

## Структура проекта
```
jirabot/
├── logs/                  # Логи (создаются автоматически)
├── sqlite/                # SQLite база данных (создается автоматически)
├── .dockerignore          # Игнорируемые файлы для Docker
├── .gitignore             # Игнорируемые файлы для Git
├── .env.dict              # Пример файла .env
├── api.py                 # Логика работы с Jira API
├── app_Main.py            # Основной файл бота (Telegram логика)
├── db.py                  # Логика работы с SQLite
├── Dockerfile             # Конфигурация Docker
├── logs_ctrl.py           # Настройка логирования
├── README.md              # Документация
├── requirements.txt       # Зависимости
```

## Контрибьютинг
1. Сделайте форк репозитория.
2. Создайте новую ветку: `git checkout -b feature/your-feature`.
3. Внесите изменения и закоммитьте: `git commit -m "Add your feature"`.
4. Отправьте изменения: `git push origin feature/your-feature`.
5. Создайте Pull Request.

Пожалуйста, соблюдайте стиль кода (PEP 8) и добавляйте комментарии к сложным участкам.
